<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ì „ë§¹ì•½ì‘í—¬í¼</title>
    
    <!-- Favicon ì„¤ì • -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="img/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="128x128" href="img/favicon-128x128.png">
    <link rel="icon" type="image/png" sizes="196x196" href="img/favicon-196x196.png">
    <link rel="apple-touch-icon" sizes="196x196" href="img/favicon-196x196.png">
    
    <link rel="stylesheet" href="styles.css">
    
    <style>
        /* ë²„íŠ¼ í…ìŠ¤íŠ¸ ì •ë ¬ ê°œì„  */
        .btn {
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            vertical-align: middle !important;
        }
        
        .btn * {
            vertical-align: middle !important;
        }
        
        .btn .icon {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        .btn .icon img {
            vertical-align: middle !important;
        }
        
        /* ì…€ë ‰íŠ¸ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ê°œì„  */
        .form-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('img/chevron-down.svg');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }
        
        .form-select::-ms-expand {
            display: none;
        }
        
        .form-select:focus {
            outline: none;
            border-color: #0D6DFD;
            box-shadow: 0 0 0 3px rgba(13, 109, 253, 0.1);
        }
    </style>

</head>
<body>
    <!-- GNB -->
    <header class="gnb">
        <div class="gnb-container">
            <div class="gnb-left">
                <button class="gnb-logo" onclick="navigateTo('home')">
                    <img src="img/logo.png" alt="ë¶€ìºë§¹ì•½ëŸ° ë¡œê³ " />
                </button>
            </div>
            <div class="gnb-right">
                <div class="account-selector">
                    <select id="accountSelect" onchange="changeAccount(this.value)" disabled>
                        <option value="">ê³„ì •ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <span id="statusIndicator" class="status-indicator status-offline"></span>
            </div>
        </div>
    </header>

    <!-- ì‚¬ì´ë“œë°” -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-content">
            <ul class="nav-menu">
                <li><a href="#" onclick="navigateTo('home')" class="nav-item active" data-view="home">
                    <span class="nav-icon"><img src="img/home.svg"></span> ë©”ì¸
                </a></li>
                <li><a href="#" onclick="navigateTo('accounts')" class="nav-item" data-view="accounts">
                    <span class="nav-icon"><img src="img/account.svg"></span> ê³„ì • ê´€ë¦¬
                </a></li>
                <li><a href="#" onclick="navigateTo('characters')" class="nav-item" data-view="characters">
                    <span class="nav-icon"><img src="img/user.svg"></span> ë¶€ìº ê´€ë¦¬
                </a></li>
                <li><a href="#" onclick="navigateTo('calendar')" class="nav-item" data-view="calendar">
                    <span class="nav-icon"><img src="img/calendar.svg"></span> ìº˜ë¦°ë”
                </a></li>
                <li><a href="#" onclick="navigateTo('settings')" class="nav-item" data-view="settings">
                    <span class="nav-icon"><img src="img/settings.svg"></span> ì„¤ì •
                </a></li>
            </ul>
        </div>
    </nav>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
        <!-- ì•± ì½˜í…ì¸ ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
    </main>

    <!-- ëª¨ë‹¬ë“¤ -->
    <div id="modalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">ì œëª©</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalContent">
                <!-- ëª¨ë‹¬ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ìƒíƒœ ê´€ë¦¬
        let currentView = 'home';
        let selectedAccountId = null;
        let accounts = [];
        let characters = [];
        let settings = {};
        let activityLogs = [];
        let currentCalendarDate = new Date();

        // ìƒìˆ˜ ì •ì˜
        const SERVERS = {
            'ì•„ìš°ë¦¬ì—˜': ['ì•„ìš°ë¦¬ì—˜ 01', 'ì•„ìš°ë¦¬ì—˜ 04', 'ì•„ìš°ë¦¬ì—˜ 05'],
            'ë¡ ë„': ['ë¡ ë„ 02', 'ë¡ ë„ 03', 'ë¡ ë„ 04'],
            'ë¼ì¸ì†Œí”„': ['ë¼ì¸ì†Œí”„ 01', 'ë¼ì¸ì†Œí”„ 02', 'ë¼ì¸ì†Œí”„ 03', 'ë¼ì¸ì†Œí”„ 05'],
            'ì‹œê¸¸': ['ì‹œê¸¸ 01', 'ì‹œê¸¸ 04'],
            'ì•„ë¯¼íƒ€': ['ì•„ë¯¼íƒ€ 01', 'ì•„ë¯¼íƒ€ 02', 'ì•„ë¯¼íƒ€ 03', 'ì•„ë¯¼íƒ€ 05'],
            'ì´ì˜¤ìŠ¤': ['ì´ì˜¤ìŠ¤ 01', 'ì´ì˜¤ìŠ¤ 02', 'ì´ì˜¤ìŠ¤ 03'],
            'ê°€ë¦¬ì•ˆ': ['ê°€ë¦¬ì•ˆ 03', 'ê°€ë¦¬ì•ˆ 04', 'ê°€ë¦¬ì•ˆ 05'],
            'ë²¨ì„¸ì´ì¦ˆ': ['ë²¨ì„¸ì´ì¦ˆ 01', 'ë²¨ì„¸ì´ì¦ˆ 03', 'ë²¨ì„¸ì´ì¦ˆ 04'],
            'ì‚¬ë„ë°”': ['ì‚¬ë„ë°” 01', 'ì‚¬ë„ë°” 02', 'ì‚¬ë„ë°” 04'],
            'ì œë¡¬': ['ì œë¡¬ 01', 'ì œë¡¬ 04', 'ì œë¡¬ 05'],
            'ì•„í‹°ì‚°': ['ì•„í‹°ì‚° 01', 'ì•„í‹°ì‚° 02', 'ì•„í‹°ì‚° 04'],
            'ì—˜ë Œ': ['ì—˜ë Œ 01', 'ì—˜ë Œ 02', 'ì—˜ë Œ 04'],
            'ë‚˜ì„¸ë¥´': ['ë‚˜ì„¸ë¥´ 01', 'ë‚˜ì„¸ë¥´ 02', 'ë‚˜ì„¸ë¥´ 03', 'ë‚˜ì„¸ë¥´ 05'],
            'í•„ë ˆì¸ ': ['í•„ë ˆì¸  01', 'í•„ë ˆì¸  03', 'í•„ë ˆì¸  05'],
            'íƒ€ë¦¬ì•„': ['íƒ€ë¦¬ì•„ 01', 'íƒ€ë¦¬ì•„ 02', 'íƒ€ë¦¬ì•„ 03', 'íƒ€ë¦¬ì•„ 04'],
            'ì¹´ë ': ['ì¹´ë  01', 'ì¹´ë  02', 'ì¹´ë  04', 'ì¹´ë  05'],
            'ë‚˜ìŠ¤ì¹´': ['ë‚˜ìŠ¤ì¹´ 02', 'ë‚˜ìŠ¤ì¹´ 03'],
            'ë²¤ì•„íŠ¸': ['ë²¤ì•„íŠ¸ 01', 'ë²¤ì•„íŠ¸ 02', 'ë²¤ì•„íŠ¸ 03'],
            'í˜ë„¬ë¡œí˜': ['í˜ë„¬ë¡œí˜ 01', 'í˜ë„¬ë¡œí˜ 02', 'í˜ë„¬ë¡œí˜ 03'],
            'ë§ˆì»¤ìŠ¤': ['ë§ˆì»¤ìŠ¤ 03', 'ë§ˆì»¤ìŠ¤ 04', 'ë§ˆì»¤ìŠ¤ 05', 'ë§ˆì»¤ìŠ¤ 06', 'ë§ˆì»¤ìŠ¤ 07'],
            'ë¥´ë¹„ì•ˆíŠ¸': ['ë¥´ë¹„ì•ˆíŠ¸ 03'],
            'ì¹´ì‹œë¯¸ë¥´': ['ì¹´ì‹œë¯¸ë¥´ 01', 'ì¹´ì‹œë¯¸ë¥´ 02'],
            'íŠ¸ë Œì²´': ['íŠ¸ë Œì²´ 01', 'íŠ¸ë Œì²´ 02', 'íŠ¸ë Œì²´ 03'],
            'ë°”ì´ëŒ': ['ë°”ì´ëŒ 01', 'ë°”ì´ëŒ 02', 'ë°”ì´ëŒ 03', 'ë°”ì´ëŒ 04'],
            'ë©”ë¥´ë¹„ìŠ¤': ['ë©”ë¥´ë¹„ìŠ¤ 01', 'ë©”ë¥´ë¹„ìŠ¤ 02', 'ë©”ë¥´ë¹„ìŠ¤ 03']
        };

        const STRONGHOLDS = {
            'í¬ë¡ ': [
                'ì„œë¦¬ì ˆë²½ ì£¼ë‘”ì§€', 'ëˆˆë°”ëŒ í•´ì•ˆ ì£¼ë‘”ì§€', 'ë°±ì•¼ì„± ìš”ìƒˆ', 'ëˆˆê½ƒë¹™í•˜ ì£¼ë‘”ì§€'
            ],
            'ë¼ì¸ì†Œí”„': [
                'íŒŒë„ë§ì´ ì£¼ë‘”ì§€', 'í™©ê¸ˆí•­ ìš”ìƒˆ', 'ë¬´ë²•ì§€ëŒ€ ì£¼ë‘”ì§€', 'ìš´í•˜ë¯¸ë¡œ ì£¼ë‘”ì§€', 
                'ìš©ì•”í„° ì£¼ë‘”ì§€', 'ì†Œê¸ˆ ë²ŒíŒ ì£¼ë‘”ì§€', 'ë– ì˜¤ë¥¸ ë°”ë‹¤ ì£¼ë‘”ì§€'
            ],
            'ì‹œê¸¸': [
                'ìŠí˜€ì§„ ì‹ ì „ ì£¼ë‘”ì§€', 'ëª¨ë˜ì¹¼ë‚  ì£¼ë‘”ì§€', 'ì¿ë¹›ë‹¬ ìš”ìƒˆ'
            ],
            'ì•„ë¯¼íƒ€': [
                'ê±°ìš¸ìˆ² ìš”ìƒˆ', 'ê²€ì€ìˆ² ì£¼ë‘”ì§€', 'ì€ë¹›ì¥ì› ì£¼ë‘”ì§€', 'ì¶•ì œìˆ˜ë¦¼ ì£¼ë‘”ì§€', 
                'ìˆ²ì˜ ë¬´ë¤ ì£¼ë‘”ì§€', 'í‘¸ë¥¸ë¶ˆê½ƒ ì£¼ë‘”ì§€'
            ],
            'ë¡ ë„': [
                'ë¡ ë„ ëŒ€ì„±ì±„', 'í† ë£¡ê³¡ ì£¼ë‘”ì§€', 'í†µê³¡ì˜ ê³ ì„± ì£¼ë‘”ì§€', 'ì•ˆê°œí˜¸ìˆ˜ ì£¼ë‘”ì§€', 
                'ì–´ë‘ ë…¸ì„ ì£¼ë‘”ì§€', 'ë¶‰ì€ ë‚˜ë½ ì£¼ë‘”ì§€'
            ]
        };

        const FACTIONS = [
            'ì¹´ì‹œë¯¸ë¥´ì—°í•©', 'ì•„ìŠ¬ë¼ë‹ˆìŠ¤', 'í™©í˜¼ì˜í˜•ì œë“¤', 'ì‹ ê¸°ë£¨ì—°ëŒ€', 'íƒ€ë¼í”„', 'ì±„ì›€ì˜íƒ‘',
            'ì–½í˜ê³µë‹¨', 'ì§ì¡°ê³µê¸¸ë“œ', 'ë¶‰ì€ë‹»', 'íŒŒë„ëª°ì´', 'ê¹ƒí„¸íœ', 'ë°±ì•¼ìˆ˜',
            'ìˆ˜í’€ë¯¼', 'ë¬˜ì§€ê¸°', 'ì•ˆê°œì§€ê¸°', 'ì‚¬ì´ë…¸ë“œ'
        ];

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì•± ì‹œì‘
        window.addEventListener('load', function() {
            loadData();
            // 1ì´ˆ í›„ ìë™ìœ¼ë¡œ ì•±ìœ¼ë¡œ ì´ë™
            setTimeout(() => {
                startApp();
            }, 1000);
        });

        // ë°ì´í„° ë¡œë“œ
        function loadData() {
            accounts = JSON.parse(localStorage.getItem('prasia_accounts') || '[]');
            characters = JSON.parse(localStorage.getItem('prasia_characters') || '[]');
            settings = JSON.parse(localStorage.getItem('prasia_settings') || '{}');
            activityLogs = JSON.parse(localStorage.getItem('prasia_activity') || '[]');
            selectedAccountId = settings.selectedAccountId || (accounts.length > 0 ? accounts[0].id : null);
        }

        // ë°ì´í„° ì €ì¥
        function saveData() {
            localStorage.setItem('prasia_accounts', JSON.stringify(accounts));
            localStorage.setItem('prasia_characters', JSON.stringify(characters));
            localStorage.setItem('prasia_settings', JSON.stringify(settings));
            localStorage.setItem('prasia_activity', JSON.stringify(activityLogs));
        }

        // ì•± ì‹œì‘
        function startApp() {
            // ê¸°ì¡´ ë°ëª¨ UI ì™„ì „íˆ ì œê±°
            const main = document.querySelector('main');
            main.innerHTML = '';
            
            // ì‚¬ì´ë“œë°” í‘œì‹œ
            document.getElementById('sidebar').classList.add('open');
            document.querySelector('.main-content').classList.add('sidebar-open');
            
            // ê³„ì • ì„ íƒê¸° ì—…ë°ì´íŠ¸
            updateAccountSelector();
            
            // ì•± UI í‘œì‹œ
            if (accounts.length === 0) {
                showOnboarding();
            } else {
                navigateTo('home');
            }
        }

        // ê³„ì • ì„ íƒê¸° ì—…ë°ì´íŠ¸
        function updateAccountSelector() {
            const select = document.getElementById('accountSelect');
            select.innerHTML = '<option value="">ê³„ì •ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            
            accounts.forEach(account => {
                const option = document.createElement('option');
                option.value = account.id;
                option.textContent = account.name + (account.isPrimary ? ' (ë³¸ê³„ì •)' : '');
                if (account.id === selectedAccountId) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
            
            select.disabled = accounts.length === 0;
        }

        // ê³„ì • ë³€ê²½
        function changeAccount(accountId) {
            selectedAccountId = accountId;
            settings.selectedAccountId = accountId;
            saveData();
            
            // í˜„ì¬ ë·° ìƒˆë¡œê³ ì¹¨
            navigateTo(currentView);
        }

        // ë„¤ë¹„ê²Œì´ì…˜
        function navigateTo(view) {
            currentView = view;
            
            // ì‚¬ì´ë“œë°” í™œì„± ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-view="${view}"]`).classList.add('active');
            
            // ë·° ë Œë”ë§
            switch(view) {
                case 'home':
                    renderHomeView();
                    break;
                case 'accounts':
                    renderAccountsView();
                    break;
                case 'characters':
                    renderCharactersView();
                    break;
                case 'calendar':
                    renderCalendarView();
                    break;
                case 'settings':
                    renderSettingsView();
                    break;
            }
        }

        // ì˜¨ë³´ë”© í™”ë©´
        function showOnboarding() {
            const main = document.querySelector('main');
            main.innerHTML = `
                <div class="app-container">
                    <div class="welcome-card">
                        <h2>ê³„ì •ì„ ë¨¼ì € ì¶”ê°€í•´ì£¼ì„¸ìš” :-)</h2>
                        <p>ê³„ì •ì„ í†µí•´ ë§¹ì•½ ì¦ì„œ êµ¬ë§¤ í˜„í™©ì„ ê´€ë¦¬í•©ë‹ˆë‹¤. ì´í›„ ë¶€ìºë¥¼ ì—°ê²°í•´ ì˜ë¢°Â·ë ˆë²¨ì„ ì¶”ì í•  ìˆ˜ ìˆì–´ìš”.</p>
                        
                        <div class="quick-actions">
                            <button class="btn btn-primary" onclick="showAddAccountModal()">
                                <span class="icon"><img src="img/plus.svg"></span>
                                ê³„ì • ì¶”ê°€
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // í™ˆ ë·° ë Œë”ë§
        function renderHomeView() {
            const selectedAccount = accounts.find(acc => acc.id === selectedAccountId);
            const accountCharacters = characters.filter(char => char.accountId === selectedAccountId);
            
            const main = document.querySelector('main');
            main.innerHTML = `
                <div class="app-container flex-column">
                    ${selectedAccount ? `
                        <div class="account-summary">
                            <h2>ê³„ì • í˜„í™©</h2>
                            <div class="account-card main-account">
                                <h3>${selectedAccount.name} ${selectedAccount.isPrimary ? '<span class="badge primary">ë³¸ê³„ì •</span>' : ''}</h3>
                                <p>ë§¹ì•½ ì¦ì„œ: ${selectedAccount.covenants.purchased.length}ê°œ êµ¬ë§¤ / ${selectedAccount.covenants.total}ê°œ ì „ì²´</p>
                                <button class="btn" onclick="navigateTo('accounts')">
                                    ê³„ì •ê´€ë¦¬
                                    <span class="icon"><img src="img/chevron-right.svg"></span>
                                    
                                </button>
                            </div>
                            
                        </div>
                        
                        <div class="characters-section">
                            <h2>ë¶€ìº í˜„í™©</h2>
                            ${accountCharacters.length > 0 ? `
                                <div class="characters-grid">
                                    ${accountCharacters.map(char => `
                                        <div class="character-card">
                                            <h4>${char.name}</h4>
                                            <p>ë ˆë²¨: ${char.level || 'ë¯¸ì„¤ì •'}</p>
                                            <p>ì„œë²„: ${char.server} - ${char.channel}</p>
                                            <div class="quest-progress">
                                                <p>ì˜ë¢° ì§„í–‰ë„: ${getTotalQuestCount(char)}/20 (${20 - getTotalQuestCount(char)}ê°œ ë‚¨ìŒ)</p>
                                                <div class="progress-bar">
                                                    <div class="progress-fill" style="width: ${(getTotalQuestCount(char) / 20) * 100}%"></div>
                                                </div>
                                            </div>
                                            <div class="character-actions">
                                                <button class="btn btn-sm btn-gray" onclick="editCharacter('${char.id}')">í¸ì§‘</button>
                                                <button class="btn btn-sm btn-gray" onclick="updateQuestCount('${char.id}')">ì˜ë¢° ì¹´ìš´íŠ¸</button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : `
                                <div class="empty-state">
                                    <p>ë“±ë¡ëœ ë¶€ìºê°€ ì—†ìŠµë‹ˆë‹¤. </p>
                                    <p>ìƒë‹¨ì˜ "ë¶€ìº ì¶”ê°€í•˜ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë¶€ìºë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.</p>
                                </div>
                            `}
                        </div>
                        
                        <div class="quick-actions main-quick-actions">
                            <button class="btn btn-primary" onclick="navigateTo('characters')">
                                <span class="icon"><img src="img/plus.svg"></span>
                                ë¶€ìº ì¶”ê°€í•˜ê¸°
                            </button>
                            <button class="btn btn-secondary" onclick="navigateTo('calendar')">
                                <span class="icon"><img src="img/calendar.svg"></span>
                                í™œë™ ê¸°ë¡ ìº˜ë¦°ë”
                            </button>
                        </div>
                    ` : `
                        <div class="welcome-card">
                            <h2>ê³„ì •ì„ ë¨¼ì € ì¶”ê°€í•´ì£¼ì„¸ìš” :-)</h2>
                            <p>ê³„ì •ì€ ë§¹ì•½ ì¦ì„œ êµ¬ë§¤ í˜„í™©ì„ ê´€ë¦¬í•©ë‹ˆë‹¤. ì´í›„ ë¶€ìºë¥¼ ì—°ê²°í•´ ì˜ë¢°Â·ë ˆë²¨ì„ ì¶”ì í•  ìˆ˜ ìˆì–´ìš”.</p>
                            
                            <div class="quick-actions">
                                <button class="btn btn-primary" onclick="showAddAccountModal()">
                                    <span class="icon"><img src="img/plus.svg"></span>
                                    ê³„ì • ì¶”ê°€
                                </button>
                            </div>
                        </div>
                    `}

                    <span class="creator">made by í‚¤ì•¼. ë¬¸ì˜ëŠ” ì˜¤í”ˆì±„íŒ…ìœ¼ë¡œ!</span>
                </div>
            `;
        }

        // ê³„ì • ê´€ë¦¬ ë·° ë Œë”ë§
        function renderAccountsView() {
            const main = document.querySelector('main');
            main.innerHTML = `
                <div class="app-container">
                    <div class="page-header">
                        <h2>ê³„ì • ê´€ë¦¬</h2>
                        <button class="btn btn-primary" onclick="showAddAccountModal()">
                            <span class="icon"><img src="img/plus.svg"></span>
                            ê³„ì • ì¶”ê°€
                        </button>
                    </div>
                    
                    <div class="accounts-list">
                        ${accounts.map(account => `
                            <div class="account-item">
                                <div class="account-info">
                                    <h3>${account.name} ${account.isPrimary ? '<span class="badge primary">ë³¸ê³„ì •</span>' : ''}</h3>
                                    <p>ìƒì„±ì¼: ${new Date(account.createdAt).toLocaleDateString()}</p>
                                    
                                    <!-- ë§¹ì•½ ì¦ì„œ ì•„ì½”ë””ì–¸ -->
                                    <div class="covenant-accordion">
                                        <div class="accordion-header" onclick="toggleCovenantAccordion('${account.id}')">
                                            <span class="accordion-title">ë§¹ì•½ ì¦ì„œ êµ¬ë§¤ í˜„í™©</span>
                                            <span class="accordion-count">${account.covenants.purchased.length}/${account.covenants.total}ê°œ</span>
                                            <span class="accordion-arrow" id="arrow_${account.id}"><img src="img/chevron-down.svg"></span>
                                        </div>
                                        <div class="accordion-content" id="content_${account.id}" style="display: none;">
                                            <div class="covenant-groups">
                                                <div class="covenant-group">
                                                    <h4>ëŒ€í˜•íŒŒë²Œ</h4>
                                                    <div class="covenant-checkboxes">
                                                        ${FACTIONS.slice(0, 4).map(faction => {
                                                            const isPurchased = account.covenants.purchased.includes(faction);
                                                            return `
                                                                <div class="checkbox-item">
                                                                    <input type="checkbox" id="covenant_${account.id}_${faction}" value="${faction}" ${isPurchased ? 'checked' : ''} onchange="updateCovenantCount('${account.id}')">
                                                                    <label for="covenant_${account.id}_${faction}">${faction}</label>
                                                                </div>
                                                            `;
                                                        }).join('')}
                                                    </div>
                                                </div>
                                                <div class="covenant-group">
                                                    <h4>ì–½í˜íŒŒë²Œ</h4>
                                                    <div class="covenant-checkboxes">
                                                        ${FACTIONS.slice(4, 10).map(faction => {
                                                            const isPurchased = account.covenants.purchased.includes(faction);
                                                            return `
                                                                <div class="checkbox-item">
                                                                    <input type="checkbox" id="covenant_${account.id}_${faction}" value="${faction}" ${isPurchased ? 'checked' : ''} onchange="updateCovenantCount('${account.id}')">
                                                                    <label for="covenant_${account.id}_${faction}">${faction}</label>
                                                                </div>
                                                            `;
                                                        }).join('')}
                                                    </div>
                                                </div>
                                                <div class="covenant-group">
                                                    <h4>ì‹¬ì—°íŒŒë²Œ</h4>
                                                    <div class="covenant-checkboxes">
                                                        ${FACTIONS.slice(10, 16).map(faction => {
                                                            const isPurchased = account.covenants.purchased.includes(faction);
                                                            return `
                                                                <div class="checkbox-item">
                                                                    <input type="checkbox" id="covenant_${account.id}_${faction}" value="${faction}" ${isPurchased ? 'checked' : ''} onchange="updateCovenantCount('${account.id}')">
                                                                    <label for="covenant_${account.id}_${faction}">${faction}</label>
                                                                </div>
                                                            `;
                                                        }).join('')}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="account-actions">
                                    <button class="btn btn-sm" onclick="editAccount('${account.id}')">í¸ì§‘</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteAccount('${account.id}')">ì‚­ì œ</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // ë¶€ìº ê´€ë¦¬ ë·° ë Œë”ë§
        function renderCharactersView() {
            const accountCharacters = characters.filter(char => char.accountId === selectedAccountId);
            
            const main = document.querySelector('main');
            main.innerHTML = `
                <div class="app-container">
                    <div class="page-header">
                        <h2>ë¶€ìº ê´€ë¦¬</h2>
                        <button class="btn btn-primary" onclick="showAddCharacterModal()">
                            <span class="icon"><img src="img/plus.svg"></span>
                            ë¶€ìº ì¶”ê°€
                        </button>
                    </div>
                    
                    <div class="characters-list">
                        ${accountCharacters.map(character => `
                            <div class="character-item">
                                <div class="character-info">
                                    <h3>${character.name}</h3>
                                    <div class="character-info-details">
                                    <p>ë ˆë²¨: ${character.level || 'ë¯¸ì„¤ì •'}</p>
                                    <p>ì„œë²„: ${character.server || 'ë¯¸ì„¤ì •'} - ${character.serverChannel || 'ë¯¸ì„¤ì •'}</p>
                                    <div class="quest-summary">
                                        <p>ì´ ì˜ë¢°: ${getTotalQuestCount(character)}/20 (${20 - getTotalQuestCount(character)}ê°œ ë‚¨ìŒ)</p>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: ${(getTotalQuestCount(character) / 20) * 100}%"></div>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                                <div class="character-actions">
                                    <button class="btn btn-sm btn-gray" onclick="editCharacter('${character.id}')">í¸ì§‘</button>
                                    <button class="btn btn-sm btn-gray" onclick="updateQuestCount('${character.id}')">ì˜ë¢° ì¹´ìš´íŠ¸</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteCharacter('${character.id}')">ì‚­ì œ</button>
                                </div>
                            </div>
                        `).join('')}
                        
                        ${accountCharacters.length === 0 ? `
                            <div class="empty-state">
                                <p>ë“±ë¡ëœ ë¶€ìºê°€ ì—†ìŠµë‹ˆë‹¤. </p>
                                <p>ìƒë‹¨ì˜ "ë¶€ìº ì¶”ê°€" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë¶€ìºë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // ìº˜ë¦°ë” ë·° ë Œë”ë§
        function renderCalendarView() {
            const main = document.querySelector('main');
            main.innerHTML = `
                <div class="app-container">
                    <div class="page-header">
                        <h2>ìº˜ë¦°ë”</h2>
                        <div class="calendar-controls">
                            <button class="btn btn-outline" onclick="previousMonth()">
                                <span class="icon"><img src="img/chevron-left.svg"></span>
                                ì´ì „
                            </button>
                            <button class="btn btn-outline" onclick="goToToday()">
                                ì˜¤ëŠ˜
                            </button>
                            <button class="btn btn-outline" onclick="nextMonth()">
                                ë‹¤ìŒ
                                <span class="icon"><img src="img/chevron-right.svg"></span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="calendar-container">
                        <div class="calendar-header">
                            <h3 id="calendarTitle">${getCalendarTitle()}</h3>
                            <div id="todayTaskCount" class="today-task-count"></div>
                        </div>
                        <div class="calendar-grid" id="calendarGrid">
                            ${renderCalendarGrid()}
                        </div>
                    </div>
                </div>
            `;
            
            // ì˜¤ëŠ˜ ì™„ë£Œ ê±´ìˆ˜ ì—…ë°ì´íŠ¸
            updateTodayTaskCount();
        }

        // ì„¤ì • ë·° ë Œë”ë§
        function renderSettingsView() {
            const main = document.querySelector('main');
            main.innerHTML = `
                <div class="app-container">
                    <div class="page-header">
                        <h2>ì„¤ì •</h2>
                    </div>
                    
                    <div class="settings-content">
                        <div class="settings-section">
                            <h3>ë°ì´í„° ê´€ë¦¬</h3>
                            <div class="settings-actions">
                                <button class="btn btn-secondary" onclick="exportData()">
                                    <span class="icon"><img src="img/download.svg"></span>
                                    ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                                </button>
                                <button class="btn btn-secondary" onclick="importData()">
                                    <span class="icon"><img src="img/upload.svg"></span>
                                    ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                                </button>
                                <button class="btn btn-danger" onclick="clearAllData()">
                                    <span class="icon"><img src="img/trash.svg"></span>
                                    ëª¨ë“  ë°ì´í„° ì‚­ì œ
                                </button>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h3>ì•± ì •ë³´</h3>
                            <div class="app-info">
                                <p><strong>ì œì‘ì:</strong> í‚¤ì•¼</p>
                                <p><strong>ë²„ì „:</strong> 1.0.0</p>
                                <p><strong>ë°ì´í„° ì €ì¥:</strong> ë¸Œë¼ìš°ì € LocalStorage</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function getTotalQuestCount(character) {
            if (!character.zones) return 0;
            return Object.values(character.zones).filter(completed => completed === true).length;
        }

        // ìº˜ë¦°ë” ê´€ë ¨ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function getCalendarTitle() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth() + 1;
            return `${year}.${month.toString().padStart(2, '0')}`;
        }

        function previousMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendarView();
        }

        function nextMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendarView();
        }

        function goToToday() {
            currentCalendarDate = new Date();
            renderCalendarView();
        }

        function renderCalendarGrid() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // ì›”ì˜ ì²« ë²ˆì§¸ ë‚ ê³¼ ë§ˆì§€ë§‰ ë‚ 
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            // ì²« ë²ˆì§¸ ë‚ ì˜ ìš”ì¼ (0=ì¼ìš”ì¼)
            const firstDayOfWeek = firstDay.getDay();
            
            // ì›”ì˜ ì¼ìˆ˜
            const daysInMonth = lastDay.getDate();
            
            let html = `
                <div class="calendar-weekdays">
                    <div class="weekday">ì¼</div>
                    <div class="weekday">ì›”</div>
                    <div class="weekday">í™”</div>
                    <div class="weekday">ìˆ˜</div>
                    <div class="weekday">ëª©</div>
                    <div class="weekday">ê¸ˆ</div>
                    <div class="weekday">í† </div>
                </div>
                <div class="calendar-days">
            `;
            
            // ì´ì „ ë‹¬ì˜ ë¹ˆ ì¹¸ë“¤
            for (let i = 0; i < firstDayOfWeek; i++) {
                html += `<div class="calendar-day other-month"></div>`;
            }
            
            // í˜„ì¬ ë‹¬ì˜ ë‚ ì§œë“¤
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const activities = getActivitiesForDate(date);
                const isToday = isSameDate(date, new Date());
                
                html += `
                    <div class="calendar-day ${isToday ? 'today' : ''}" onclick="showDayDetails('${date.toISOString()}')">
                        <div class="day-number">${day}</div>
                        <div class="day-activities">
                            ${renderDayActivities(activities)}
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        function getActivitiesForDate(date) {
            if (!selectedAccountId) return [];
            
            const startOfDay = new Date(date);
            startOfDay.setHours(0, 0, 0, 0);
            const endOfDay = new Date(date);
            endOfDay.setHours(23, 59, 59, 999);
            
            return activityLogs.filter(log => {
                if (log.accountId !== selectedAccountId) return false;
                const logDate = new Date(log.occurredAt);
                return logDate >= startOfDay && logDate <= endOfDay;
            });
        }

        function renderDayActivities(activities) {
            if (activities.length === 0) return '';
            
            // ë¶€ìºë³„ë¡œ ê·¸ë£¹í™”
            const grouped = {};
            activities.forEach(activity => {
                const character = characters.find(c => c.id === activity.characterId);
                if (!character) return;
                
                const key = `${character.name}-${activity.location}`;
                if (!grouped[key]) {
                    grouped[key] = {
                        character: character.name,
                        location: activity.location,
                        count: 0
                    };
                }
                grouped[key].count += activity.countDelta;
            });
            
            const items = Object.values(grouped).slice(0, 3); // ìµœëŒ€ 3ê°œë§Œ í‘œì‹œ
            let html = '';
            
            items.forEach(item => {
                if (item.count > 0) {
                    html += `<div class="activity-chip">${item.character} Â· ${item.location} (${item.count})</div>`;
                }
            });
            
            if (Object.keys(grouped).length > 3) {
                const remaining = Object.keys(grouped).length - 3;
                html += `<div class="activity-chip more">+${remaining}</div>`;
            }
            
            return html;
        }

        function isSameDate(date1, date2) {
            return date1.getFullYear() === date2.getFullYear() &&
                   date1.getMonth() === date2.getMonth() &&
                   date1.getDate() === date2.getDate();
        }

        function showDayDetails(dateString) {
            const date = new Date(dateString);
            const activities = getActivitiesForDate(date);
            
            if (activities.length === 0) {
                alert(`${date.getMonth() + 1}ì›” ${date.getDate()}ì¼ì—ëŠ” í™œë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.`);
                return;
            }
            
            let content = `
                <h4 class="day-title">${date.getMonth() + 1}ì›” ${date.getDate()}ì¼ í™œë™ ê¸°ë¡</h4>
                <div class="day-activities-list" style="max-height: 500px; overflow-y: auto;">
            `;
            
            // ë¶€ìºë³„ë¡œ ê·¸ë£¹í™”
            const characterGroups = {};
            activities.forEach(activity => {
                const character = characters.find(c => c.id === activity.characterId);
                if (!character) return;
                
                if (!characterGroups[character.name]) {
                    characterGroups[character.name] = {
                        character: character.name,
                        totalCount: 0,
                        locations: {}
                    };
                }
                
                if (!characterGroups[character.name].locations[activity.location]) {
                    characterGroups[character.name].locations[activity.location] = [];
                }
                
                characterGroups[character.name].locations[activity.location].push(activity);
                characterGroups[character.name].totalCount += activity.countDelta;
            });
            
            // ë¶€ìºë³„ ë°•ìŠ¤ ìƒì„±
            Object.values(characterGroups).forEach(characterGroup => {
                content += `
                    <div class="character-activity-box" style="
                        background: #F7F8F9;
                        border: 1px solid #e5e7eb;
                        border-radius: 12px;
                        padding: 16px;
                        margin-bottom: 12px;
                    ">
                        <div class="character-header" style="
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 12px;
                            padding-bottom: 8px;
                            border-bottom: 1px solid #e5e7eb;
                        ">
                            <h5 style="margin: 0; font-size: 16px; font-weight: 600; color: #374151;">${characterGroup.character}</h5>
                            <span style="
                                background: #0D6DFD;
                                color: white;
                                padding: 4px 12px;
                                border-radius: 20px;
                                font-size: 14px;
                                font-weight: 600;
                            ">ì´ ${characterGroup.totalCount}ê±´</span>
                        </div>
                        <div class="location-list">
                `;
                
                // ì£¼ë‘”ì§€ë³„ í™œë™ í‘œì‹œ
                Object.entries(characterGroup.locations).forEach(([location, locationActivities]) => {
                    const locationTotal = locationActivities.reduce((sum, act) => sum + act.countDelta, 0);
                    if (locationTotal > 0) {
                        content += `
                            <div class="location-item" style="
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                padding: 8px 0;
                                border-bottom: 1px solid #f1f5f9;
                            ">
                                <span style="font-size: 14px; color: #64748b;">${location}</span>
                                <div class="time-list" style="display: flex; gap: 8px; flex-wrap: wrap;">
                        `;
                        
                        locationActivities.forEach(activity => {
                            if (activity.countDelta > 0) {
                                const time = new Date(activity.occurredAt).toLocaleTimeString('ko-KR', {
                                    hour: '2-digit',
                                    minute: '2-digit'
                                });
                                content += `
                                    <span style="
                                        background: #e0f2fe;
                                        color: #0369a1;
                                        padding: 2px 8px;
                                        border-radius: 4px;
                                        font-size: 12px;
                                        font-weight: 500;
                                    ">${time}</span>
                                `;
                            }
                        });
                        
                        content += `
                                </div>
                            </div>
                        `;
                    }
                });
                
                content += `
                        </div>
                    </div>
                `;
            });
            
            content += '</div>';
            
            showModal('ì¼ì¼ í™œë™ ê¸°ë¡', content);
        }

        // Activity Log ìƒì„± í•¨ìˆ˜
        function createActivityLog(characterId, location, countDelta, occurredAt = null) {
            if (!selectedAccountId) return;
            
            const now = occurredAt || new Date();
            const activity = {
                id: Date.now().toString(),
                type: 'quest',
                accountId: selectedAccountId,
                characterId: characterId,
                location: location,
                countDelta: countDelta,
                occurredAt: now.getTime(),
                createdAt: now.getTime()
            };
            
            activityLogs.push(activity);
            saveData();
            
            // ìº˜ë¦°ë” ë·°ì¸ ê²½ìš° ì˜¤ëŠ˜ ì™„ë£Œ ê±´ìˆ˜ ì—…ë°ì´íŠ¸
            if (currentView === 'calendar') {
                updateTodayTaskCount();
            }
        }

        // í™ˆ í™”ë©´ í‘œì‹œ
        function showHomeScreen() {
            const accounts = JSON.parse(localStorage.getItem('prasia_accounts') || '[]');
            const settings = JSON.parse(localStorage.getItem('prasia_settings') || '{}');
            const selectedAccount = accounts.find(acc => acc.id === settings.selectedAccountId);
            
            const main = document.querySelector('main');
            main.innerHTML = `
                <div class="app-container">
                    <div class="app-header">
                        <h1>ğŸ° ë¶€ìºë§¹ì•½ì‘</h1>
                        <p>ë¦¬ë„¤ì•„ ë§¹ì•½ ì¤€ë¹„ To-do ì›¹ì•±</p>
                    </div>
                    
                    <div class="app-content">
                        ${selectedAccount ? `
                            <div class="account-summary">
                                <h2>ğŸ“Š ê³„ì • í˜„í™©</h2>
                                <div class="account-card">
                                    <h3>${selectedAccount.name} ${selectedAccount.isPrimary ? '<span class="badge primary">ë³¸ê³„ì •</span>' : ''}</h3>
                                    <p>ë§¹ì•½ ì¦ì„œ: ${selectedAccount.covenants.purchased.length}ê°œ êµ¬ë§¤ / ${selectedAccount.covenants.total}ê°œ ì „ì²´</p>
                                </div>
                            </div>
                            
                            <div class="quick-actions">
                                <button class="btn btn-primary" onclick="addCharacter()">
                                    <span class="icon">âš”ï¸</span>
                                    ë¶€ìº ì¶”ê°€í•˜ê¸°
                                </button>
                                <button class="btn btn-secondary" onclick="manageAccounts()">
                                    <span class="icon">ğŸ‘¥</span>
                                    ê³„ì • ê´€ë¦¬
                                </button>
                            </div>
                        ` : `
                            <div class="welcome-card">
                                <h2>ê³„ì •ì„ ë¨¼ì € ì¶”ê°€í•´ì£¼ì„¸ìš” :-)</h2>
                                <p>ê³„ì •ì€ ë§¹ì•½ ì¦ì„œ êµ¬ë§¤ í˜„í™©ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                                <p>ì´í›„ ë¶€ìºë¥¼ ì—°ê²°í•´ ì˜ë¢°Â·ë ˆë²¨ì„ ì¶”ì í•˜ì„¸ìš”.</p>
                                
                                <div class="quick-actions">
                                    <button class="btn btn-primary" onclick="addAccount()">
                                        <span class="icon">ğŸ‘¤</span>
                                        ê³„ì • ì¶”ê°€
                                    </button>
                                </div>
                            </div>
                        `}
                        
                        <div class="status-info">
                            <div class="status-item">
                                <span class="status-indicator status-online"></span>
                                <span class="status-text">ë…ë¦½ ì‹¤í–‰ ëª¨ë“œ</span>
                            </div>
                            <div class="status-item">
                                <span class="status-indicator status-success"></span>
                                <span class="status-text">ë°ì´í„° ì €ì¥ ì¤€ë¹„ ì™„ë£Œ</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modalOverlay').style.display = 'none';
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener('click', function(e) {
            if (e.target.id === 'modalOverlay') {
                closeModal();
            }
        });

        // ê³„ì • ì¶”ê°€ ëª¨ë‹¬
        function showAddAccountModal() {
            const content = `
                <form id="addAccountForm">
                    <div class="form-group">
                        <label class="form-label" for="accountName">ê³„ì • ì´ë¦„</label>
                        <input type="text" id="accountName" class="form-input" placeholder="ê³„ì • ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="isPrimary" ${accounts.length === 0 ? 'checked' : ''}>
                            ë³¸ê³„ì •ìœ¼ë¡œ ì„¤ì •
                        </label>
                    </div>
                </form>
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" onclick="saveAccount()">ì €ì¥</button>
                </div>
            `;
            showModal('ê³„ì • ì¶”ê°€', content);
        }

        function saveAccount() {
            const name = document.getElementById('accountName').value.trim();
            const isPrimary = document.getElementById('isPrimary').checked;
            
            if (!name) {
                alert('ê³„ì • ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const newAccount = {
                id: Date.now().toString(),
                name: name,
                isPrimary: isPrimary,
                covenants: { purchased: [], total: 16 },
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            accounts.push(newAccount);
            selectedAccountId = newAccount.id;
            settings.selectedAccountId = newAccount.id;
            saveData();
            
            updateAccountSelector();
            closeModal();
            navigateTo('home');
        }

        // ë¶€ìº ì¶”ê°€ ëª¨ë‹¬
        function showAddCharacterModal() {
            if (!selectedAccountId) {
                alert('ë¨¼ì € ê³„ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const serverOptions = Object.keys(SERVERS).map(server => 
                `<option value="${server}">${server}</option>`
            ).join('');

            const content = `
                <form id="addCharacterForm">
                    <div class="form-group">
                        <label class="form-label" for="characterName">ë¶€ìº ì´ë¦„</label>
                        <input type="text" id="characterName" class="form-input" placeholder="ë¶€ìº ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="characterServer">ì„œë²„</label>
                            <select id="characterServer" class="form-select" onchange="updateChannelOptions(this.value)" required>
                                <option value="">ì„œë²„ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                ${serverOptions}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="characterChannel">ì±„ë„</label>
                            <select id="characterChannel" class="form-select" required disabled>
                                <option value="">ë¨¼ì € ì„œë²„ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="characterLevel">ë ˆë²¨ (ì„ íƒì‚¬í•­)</label>
                        <input type="number" id="characterLevel" class="form-input" placeholder="ë ˆë²¨ì„ ì…ë ¥í•˜ì„¸ìš”" min="1" max="100">
                    </div>
                </form>
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" onclick="saveCharacter()">ì €ì¥</button>
                </div>
            `;
            showModal('ë¶€ìº ì¶”ê°€', content);
        }

        function updateChannelOptions(selectedServer) {
            const channelSelect = document.getElementById('characterChannel');
            
            if (selectedServer && SERVERS[selectedServer]) {
                const channels = SERVERS[selectedServer];
                channelSelect.innerHTML = '<option value="">ì±„ë„ì„ ì„ íƒí•˜ì„¸ìš”</option>' + channels.map(channel => 
                    `<option value="${channel}">${channel}</option>`
                ).join('');
                channelSelect.disabled = false;
            } else {
                channelSelect.innerHTML = '<option value="">ë¨¼ì € ì„œë²„ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                channelSelect.disabled = true;
            }
        }

        function saveCharacter() {
            const name = document.getElementById('characterName').value.trim();
            const server = document.getElementById('characterServer').value;
            const channel = document.getElementById('characterChannel').value;
            const level = document.getElementById('characterLevel').value;
            
            if (!name) {
                alert('ë¶€ìº ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!server) {
                alert('ì„œë²„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!channel) {
                alert('ì±„ë„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const newCharacter = {
                id: Date.now().toString(),
                name: name,
                accountId: selectedAccountId,
                server: server,
                channel: channel,
                level: level ? parseInt(level) : null,
                zones: {},
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            characters.push(newCharacter);
            saveData();
            closeModal();
            navigateTo('characters');
        }

        // ë¶€ìº í¸ì§‘
        function editCharacter(characterId) {
            const character = characters.find(c => c.id === characterId);
            if (!character) return;

            showCharacterEditModal(characterId);
        }

        // ë¶€ìº í¸ì§‘ ëª¨ë‹¬ í‘œì‹œ
        function showCharacterEditModal(characterId) {
            const character = characters.find(c => c.id === characterId);
            if (!character) return;

            // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
            const existingModal = document.getElementById('characterEditModal');
            if (existingModal) {
                existingModal.remove();
            }

            // í¸ì§‘ ëª¨ë‹¬ ìƒì„±
            const modal = document.createElement('div');
            modal.id = 'characterEditModal';
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">ë¶€ìº í¸ì§‘</h3>
                        <button class="modal-close" type="button" onclick="closeCharacterEditModal()">&times;</button>
                    </div>
                    <div class="modal-content">
                        <form id="characterEditForm">
                            <div class="form-group">
                                <label for="editCharacterName" class="form-label">ë¶€ìº ì´ë¦„</label>
                                <input type="text" id="editCharacterName" class="form-input" value="${character.name}" required>
                            </div>
                            <div class="form-group">
                                <label for="editCharacterLevel" class="form-label">ë ˆë²¨</label>
                                <input type="number" id="editCharacterLevel" class="form-input" value="${character.level || 1}" min="1" max="100" required>
                            </div>
                            <div class="form-group">
                                <label for="editCharacterServer" class="form-label">ì„œë²„</label>
                                <select id="editCharacterServer" class="form-select" onchange="updateChannelOptionsEdit(this.value)" required>
                                    <option value="">ì„œë²„ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="editCharacterChannel" class="form-label">ì±„ë„</label>
                                <select id="editCharacterChannel" class="form-select" required>
                                    <option value="">ì±„ë„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeCharacterEditModal()">ì·¨ì†Œ</button>
                        <button type="button" class="btn btn-primary" onclick="saveCharacterEdit('${characterId}')">ì €ì¥</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // ì„œë²„ ì˜µì…˜ ì±„ìš°ê¸°
            populateServerOptions();
            
            // í˜„ì¬ ì„œë²„ ì„ íƒ
            const serverSelect = document.getElementById('editCharacterServer');
            serverSelect.value = character.server || '';
            
            // ì±„ë„ ì˜µì…˜ ì—…ë°ì´íŠ¸
            updateChannelOptionsEdit(character.server || '');
            
            // í˜„ì¬ ì±„ë„ ê°’ ì„¤ì •
            setTimeout(() => {
                const channelSelect = document.getElementById('editCharacterChannel');
                if (channelSelect && character.channel) {
                    channelSelect.value = character.channel;
                }
            }, 100);
            
            
            // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeCharacterEditModal();
                }
            });
            
            // ESC í‚¤ë¡œ ë‹«ê¸°
            const handleEscKey = (e) => {
                if (e.key === 'Escape') {
                    closeCharacterEditModal();
                    document.removeEventListener('keydown', handleEscKey);
                }
            };
            document.addEventListener('keydown', handleEscKey);
        }

        // ì„œë²„ ì˜µì…˜ ì±„ìš°ê¸°
        function populateServerOptions() {
            const serverSelect = document.getElementById('editCharacterServer');
            if (!serverSelect) return;

            // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ì˜µì…˜ ì œì™¸)
            while (serverSelect.children.length > 1) {
                serverSelect.removeChild(serverSelect.lastChild);
            }

            // ì„œë²„ ì˜µì…˜ ì¶”ê°€ (SERVERS ìƒìˆ˜ ì‚¬ìš©)
            Object.keys(SERVERS).forEach(serverName => {
                const option = document.createElement('option');
                option.value = serverName;
                option.textContent = serverName;
                serverSelect.appendChild(option);
            });
        }

        // ì±„ë„ ì˜µì…˜ ì—…ë°ì´íŠ¸ (í¸ì§‘ ëª¨ë‹¬ìš©)
        function updateChannelOptionsEdit(serverName) {
            const channelSelect = document.getElementById('editCharacterChannel');
            if (!channelSelect) return;

            // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ì˜µì…˜ ì œì™¸)
            while (channelSelect.children.length > 1) {
                channelSelect.removeChild(channelSelect.lastChild);
            }

            if (serverName && SERVERS[serverName]) {
                SERVERS[serverName].forEach(channel => {
                    const option = document.createElement('option');
                    option.value = channel;
                    option.textContent = channel;
                    channelSelect.appendChild(option);
                });
            }
        }

        // ë¶€ìº í¸ì§‘ ì €ì¥
        function saveCharacterEdit(characterId) {
            const name = document.getElementById('editCharacterName').value.trim();
            const level = parseInt(document.getElementById('editCharacterLevel').value);
            const server = document.getElementById('editCharacterServer').value;
            const channel = document.getElementById('editCharacterChannel').value;

            // ìœ íš¨ì„± ê²€ì‚¬
            if (!name) {
                alert('ë¶€ìº ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!level || level < 1 || level > 100) {
                alert('ë ˆë²¨ì€ 1-100 ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            if (!server) {
                alert('ì„œë²„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!channel) {
                alert('ì±„ë„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const character = characters.find(c => c.id === characterId);
                if (character) {
                    character.name = name;
                    character.level = level;
                    character.server = server;
                    character.serverChannel = channel;
                character.updatedAt = new Date().toISOString();
                    
                saveData();
                    closeCharacterEditModal();
                navigateTo('characters');
                    showToast('ë¶€ìº ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                }
            } catch (error) {
                console.error('ë¶€ìº í¸ì§‘ ì‹¤íŒ¨:', error);
                alert('ë¶€ìº ì •ë³´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë¶€ìº í¸ì§‘ ëª¨ë‹¬ ë‹«ê¸°
        function closeCharacterEditModal() {
            const modal = document.getElementById('characterEditModal');
            if (modal) {
                modal.remove();
            }
        }

        // ì˜ë¢° ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸ (ì²´í¬ë°•ìŠ¤ ë°©ì‹)
        function updateQuestCount(characterId) {
            const character = characters.find(c => c.id === characterId);
            if (!character) return;

            if (!character.zones) character.zones = {};

            const currentCompleted = getTotalQuestCount(character);
            
            // ì§€ì—­ë³„ ê·¸ë£¹í™”ëœ ì£¼ë‘”ì§€ í‘œì‹œ
            const regionGroups = Object.entries(STRONGHOLDS).map(([region, strongholds]) => {
                const regionCheckboxes = strongholds.map(stronghold => {
                    const isCompleted = character.zones[stronghold] === true;
                    return `
                        <div class="checkbox-item">
                            <input type="checkbox" id="stronghold_${stronghold}" value="${stronghold}" ${isCompleted ? 'checked' : ''} onchange="updateQuestCounter()">
                            <label for="stronghold_${stronghold}">${stronghold}</label>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="region-group" data-region="${region}">
                        <h4 class="region-title">${region}</h4>
                        <div class="region-strongholds">
                            ${regionCheckboxes}
                        </div>
                    </div>
                `;
            }).join('');

            // ì˜¤ë¦„ì°¨ìˆœ/ë‚´ë¦¼ì°¨ìˆœìš© í”Œë« ë¦¬ìŠ¤íŠ¸
            const allStrongholds = [];
            Object.entries(STRONGHOLDS).forEach(([region, strongholds]) => {
                strongholds.forEach(stronghold => {
                    allStrongholds.push({ region, stronghold });
                });
            });

            const flatCheckboxes = allStrongholds.map(({ region, stronghold }) => {
                const isCompleted = character.zones[stronghold] === true;
                return `
                    <div class="checkbox-item">
                        <input type="checkbox" id="stronghold_${stronghold}" value="${stronghold}" ${isCompleted ? 'checked' : ''} onchange="updateQuestCounter()">
                        <label for="stronghold_${stronghold}">${stronghold}</label>
                    </div>
                `;
            }).join('');

            const content = `
                <div class="form-group">
                    <label class="form-label">ì£¼ë‘”ì§€ ì˜ë¢° ì™„ë£Œ í˜„í™©</label>
                    <div class="form-home">
                        <strong>ì™„ë£Œ í˜„í™©: <span id="questCounter">${currentCompleted}</span>/20</strong>
                        <div class="progress-bar" style="margin-top: 8px;">
                            <div class="progress-fill" style="width: ${(currentCompleted / 20) * 100}%"></div>
                        </div>
                    </div>
                    <div class="sort-filter">
                        <label>ì •ë ¬ ë°©ì‹:</label>
                        <select id="regionSort" onchange="sortStrongholds()">
                            <option value="default">ì§€ì—­ë³„ ê·¸ë£¹</option>
                            <option value="asc">ì˜¤ë¦„ì°¨ìˆœ</option>
                            <option value="desc">ë‚´ë¦¼ì°¨ìˆœ</option>
                        </select>
                    </div>
                    <div class="checkbox-grid" id="strongholdGrid" style="max-height: 400px;">
                        <div id="regionGroups">${regionGroups}</div>
                        <div id="flatList" style="display: none;">${flatCheckboxes}</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" onclick="saveQuestCount('${characterId}')">ì €ì¥</button>
                </div>
            `;
            showModal('ì˜ë¢° ì™„ë£Œ í˜„í™© ê´€ë¦¬', content);
        }

        function updateQuestCounter() {
            const checkboxes = document.querySelectorAll('#strongholdGrid input[type="checkbox"]:checked');
            const completedCount = checkboxes.length;
            const counter = document.getElementById('questCounter');
            const progressFill = document.querySelector('#strongholdGrid').closest('.modal').querySelector('.progress-fill');
            
            if (counter) {
                counter.textContent = completedCount;
            }
            
            if (progressFill) {
                progressFill.style.width = `${(completedCount / 20) * 100}%`;
            }
        }

        function sortStrongholds() {
            const sortType = document.getElementById('regionSort').value;
            const regionGroups = document.getElementById('regionGroups');
            const flatList = document.getElementById('flatList');
            
            if (sortType === 'default') {
                regionGroups.style.display = 'block';
                flatList.style.display = 'none';
            } else {
                regionGroups.style.display = 'none';
                flatList.style.display = 'block';
                
                const checkboxes = Array.from(flatList.querySelectorAll('.checkbox-item'));
                let sortedCheckboxes;
                
                if (sortType === 'asc') {
                    sortedCheckboxes = checkboxes.sort((a, b) => {
                        const labelA = a.querySelector('label').textContent;
                        const labelB = b.querySelector('label').textContent;
                        return labelA.localeCompare(labelB);
                    });
                } else if (sortType === 'desc') {
                    sortedCheckboxes = checkboxes.sort((a, b) => {
                        const labelA = a.querySelector('label').textContent;
                        const labelB = b.querySelector('label').textContent;
                        return labelB.localeCompare(labelA);
                    });
                }
                
                flatList.innerHTML = '';
                sortedCheckboxes.forEach(item => flatList.appendChild(item));
            }
        }

        function saveQuestCount(characterId) {
            const character = characters.find(c => c.id === characterId);
            const checkboxes = document.querySelectorAll('#strongholdGrid input[type="checkbox"]');
            
            // ì´ì „ ìƒíƒœì™€ ë¹„êµí•˜ì—¬ ë³€ê²½ì‚¬í•­ ì¶”ì 
            const previousZones = { ...character.zones };
            
            // ëª¨ë“  ì£¼ë‘”ì§€ë¥¼ falseë¡œ ì´ˆê¸°í™”
            Object.keys(STRONGHOLDS).forEach(region => {
                STRONGHOLDS[region].forEach(stronghold => {
                    character.zones[stronghold] = false;
                });
            });
            
            // ì²´í¬ëœ ì£¼ë‘”ì§€ë§Œ trueë¡œ ì„¤ì •í•˜ê³  Activity Log ìƒì„±
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    character.zones[checkbox.value] = true;
                    
                    // ìƒˆë¡œ ì™„ë£Œëœ ì£¼ë‘”ì§€ì¸ ê²½ìš° Activity Log ìƒì„±
                    if (!previousZones[checkbox.value]) {
                        createActivityLog(characterId, checkbox.value, 1);
                    }
                } else if (previousZones[checkbox.value]) {
                    // ì™„ë£Œ í•´ì œëœ ì£¼ë‘”ì§€ì¸ ê²½ìš° Activity Log ìƒì„± (ìŒìˆ˜)
                    createActivityLog(characterId, checkbox.value, -1);
                }
            });
            
            character.updatedAt = new Date().toISOString();
            saveData();
            closeModal();
            navigateTo('characters');
        }

        // ë¶€ìº ì‚­ì œ
        function deleteCharacter(characterId) {
            if (confirm('ì •ë§ë¡œ ì´ ë¶€ìºë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                characters = characters.filter(c => c.id !== characterId);
                saveData();
                navigateTo('characters');
            }
        }

        // ê³„ì • í¸ì§‘
        function editAccount(accountId) {
            const account = accounts.find(a => a.id === accountId);
            if (!account) return;

            const newName = prompt('ê³„ì • ì´ë¦„ì„ ìˆ˜ì •í•˜ì„¸ìš”:', account.name);
            if (newName && newName.trim()) {
                account.name = newName.trim();
                account.updatedAt = new Date().toISOString();
                saveData();
                updateAccountSelector();
                navigateTo('accounts');
            }
        }

        // ì•„ì½”ë””ì–¸ í† ê¸€
        function toggleCovenantAccordion(accountId) {
            const content = document.getElementById(`content_${accountId}`);
            const arrow = document.getElementById(`arrow_${accountId}`);
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                arrow.classList.add('rotated');
            } else {
                content.style.display = 'none';
                arrow.classList.remove('rotated');
            }
        }

        // ë§¹ì•½ ì¦ì„œ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        function updateCovenantCount(accountId) {
            const account = accounts.find(a => a.id === accountId);
            if (!account) return;

            const checkboxes = document.querySelectorAll(`input[id^="covenant_${accountId}_"]:checked`);
            const purchased = Array.from(checkboxes).map(cb => cb.value);
            
            account.covenants.purchased = purchased;
            account.updatedAt = new Date().toISOString();
            saveData();
            
            // ì•„ì½”ë””ì–¸ í—¤ë”ì˜ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            const countElement = document.querySelector(`#content_${accountId}`).previousElementSibling.querySelector('.accordion-count');
            if (countElement) {
                countElement.textContent = `${purchased.length}/${account.covenants.total}ê°œ`;
            }
        }

        // ê³„ì • ì‚­ì œ
        function deleteAccount(accountId) {
            if (confirm('ì •ë§ë¡œ ì´ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì—°ê²°ëœ ë¶€ìºë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) {
                accounts = accounts.filter(a => a.id !== accountId);
                characters = characters.filter(c => c.accountId !== accountId);
                
                if (selectedAccountId === accountId) {
                    selectedAccountId = accounts.length > 0 ? accounts[0].id : null;
                    settings.selectedAccountId = selectedAccountId;
                }
                
                saveData();
                updateAccountSelector();
                navigateTo('accounts');
            }
        }

        // ìº˜ë¦°ë” ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportCalendarData() {
            const accountActivities = activityLogs.filter(log => log.accountId === selectedAccountId);
            if (accountActivities.length === 0) {
                alert('ë‚´ë³´ë‚¼ í™œë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const data = {
                activities: accountActivities,
                characters: characters.filter(char => char.accountId === selectedAccountId),
                exportDate: new Date().toISOString(),
                timezone: 'Asia/Seoul'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ë¶€ìºë§¹ì•½ì‘_í™œë™ê¸°ë¡_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportData() {
            const data = {
                accounts,
                characters,
                settings,
                activities: activityLogs,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ë¶€ìºë§¹ì•½ì‘_ë°ì´í„°_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (confirm('ê¸°ì¡´ ë°ì´í„°ë¥¼ ëª¨ë‘ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                accounts = data.accounts || [];
                                characters = data.characters || [];
                                settings = data.settings || {};
                                activityLogs = data.activities || [];
                                selectedAccountId = settings.selectedAccountId;
                                saveData();
                                updateAccountSelector();
                                navigateTo('home');
                                alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.');
                            }
                        } catch (error) {
                            alert('íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // ëª¨ë“  ë°ì´í„° ì‚­ì œ
        function clearAllData() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                localStorage.removeItem('prasia_accounts');
                localStorage.removeItem('prasia_characters');
                localStorage.removeItem('prasia_settings');
                localStorage.removeItem('prasia_activity');
                accounts = [];
                characters = [];
                settings = {};
                activityLogs = [];
                selectedAccountId = null;
                updateAccountSelector();
                showOnboarding();
                alert('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateStatus() {
            const indicator = document.getElementById('statusIndicator');
            const text = document.getElementById('statusText');
            
            if (indicator && text) {
                indicator.className = 'status-indicator status-online';
                text.textContent = 'ë…ë¦½ ì‹¤í–‰ ëª¨ë“œ (ì˜¨ë¼ì¸)';
            }
        }

        // ë°ëª¨ ë°ì´í„° ìƒì„± (í…ŒìŠ¤íŠ¸ìš©)
        function createDemoData() {
            if (activityLogs.length > 0) return; // ì´ë¯¸ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ìƒì„±í•˜ì§€ ì•ŠìŒ
            
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const twoDaysAgo = new Date(today);
            twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);
            
            // ë°ëª¨ Activity Log ìƒì„±
            const demoActivities = [
                {
                    id: 'demo1',
                    type: 'quest',
                    accountId: selectedAccountId,
                    characterId: characters[0]?.id,
                    location: 'íŒŒë„ë§ì´ ì£¼ë‘”ì§€',
                    countDelta: 1,
                    occurredAt: today.getTime(),
                    createdAt: today.getTime()
                },
                {
                    id: 'demo2',
                    type: 'quest',
                    accountId: selectedAccountId,
                    characterId: characters[0]?.id,
                    location: 'í™©ê¸ˆí•­ ìš”ìƒˆ',
                    countDelta: 1,
                    occurredAt: yesterday.getTime(),
                    createdAt: yesterday.getTime()
                },
                {
                    id: 'demo3',
                    type: 'quest',
                    accountId: selectedAccountId,
                    characterId: characters[1]?.id,
                    location: 'ì„œë¦¬ì ˆë²½ ì£¼ë‘”ì§€',
                    countDelta: 1,
                    occurredAt: twoDaysAgo.getTime(),
                    createdAt: twoDaysAgo.getTime()
                }
            ];
            
            activityLogs.push(...demoActivities);
            saveData();
        }

        // ì˜¤ëŠ˜ ì™„ë£Œëœ í• ì¼ ìˆ˜ ì—…ë°ì´íŠ¸
        function updateTodayTaskCount() {
            const today = new Date();
            const todayString = today.toDateString();
            
            // ì˜¤ëŠ˜ ì™„ë£Œëœ ì˜ë¢° ìˆ˜ ê³„ì‚° (ì–‘ìˆ˜ countDeltaë§Œ ì¹´ìš´íŠ¸)
            const todayCompletedTasks = activityLogs.filter(activity => {
                if (!activity.occurredAt) return false;
                if (activity.countDelta <= 0) return false; // ì–‘ìˆ˜ë§Œ ì¹´ìš´íŠ¸ (ì™„ë£Œ)
                if (activity.accountId !== selectedAccountId) return false; // í˜„ì¬ ê³„ì •ë§Œ
                
                const activityDate = new Date(activity.occurredAt);
                return activityDate.toDateString() === todayString;
            });
            
            
            // ì˜¤ëŠ˜ í• ì¼ ìˆ˜ í‘œì‹œ ìš”ì†Œ ì°¾ê¸°
            const todayCountElement = document.getElementById('todayTaskCount');
            if (todayCountElement) {
                // ì´ ì™„ë£Œ ê±´ìˆ˜ë§Œ í‘œì‹œ
                const totalCount = todayCompletedTasks.reduce((sum, activity) => sum + activity.countDelta, 0);
                
                todayCountElement.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 14px; color: #374151;">ì˜¤ëŠ˜ ì´ ì™„ë£Œ ê°¯ìˆ˜:</span>
                        <span style="background: #0D6DFD; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">${totalCount}ê±´</span>
                    </div>
                `;
                
                // ìŠ¤íƒ€ì¼ ì ìš©
                todayCountElement.style.cssText = `
                    background: #ffffff;
                    border: 1px solid #e5e7eb;
                    color: #374151;
                    padding: 12px 16px;
                    border-radius: 12px;
                    font-size: 14px;
                    margin-top: 10px;
                    display: inline-block;
                `;
            }
        }

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showToast(message, type = 'info') {
            // ê¸°ì¡´ í† ìŠ¤íŠ¸ ì œê±°
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            // í† ìŠ¤íŠ¸ ìƒì„±
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#059669' : type === 'error' ? '#dc2626' : '#0D6DFD'};
                color: white;
                padding: 12px 20px;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 500;
                z-index: 10000;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            toast.textContent = message;

            document.body.appendChild(toast);

            // ì• ë‹ˆë©”ì´ì…˜
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
            }, 100);

            // 3ì´ˆ í›„ ì œê±°
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus();
        });
    </script>
</body>
</html>
